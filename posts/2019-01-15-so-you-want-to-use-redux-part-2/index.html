<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>So you want to use Redux (pt 2) — reducers and scale</title>
  <meta name="description" content="I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.">

    <!--
      Hello, and welcome to the source for my site!
      There's not a lot to see around here, but I hope you get some inspiration/ideas/laughs.

      Here's an ASCII art stick figure saying hi:  o/
                                                  /|
                                                  / \

      Also, no, I'm not Spanish. I just like short domain names.
    -->

  <link rel="canonical" href="https://sgom.es/">
  <link rel="alternate" type="application/rss+xml" title="sgom.es" href="/feed.xml">

  <link rel="manifest" href="/manifest.json">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="sgom.es">
  <link rel="icon" sizes="16x16" href="/assets/images/touch/16x16.png">
  <link rel="icon" sizes="32x32" href="/assets/images/touch/32x32.png">
  <link rel="icon" sizes="192x192" href="/assets/images/touch/192x192.png">
  <link rel="icon" sizes="512x512" href="/assets/images/touch/512x512.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="sgom.es">
  <link rel="apple-touch-icon" href="/assets/images/touch/152x152.png">

  <meta name="msapplication-TileImage" content="/assets/images/touch/144x144.png">
  <meta name="msapplication-TileColor" content="#009688">

  <meta name="theme-color" content="#009688">

  <link rel="preconnect" href="https://fonts.gstatic.com">

  <style>
  
  @import url(https://fonts.googleapis.com/css?family=Roboto+Mono|Rubik:400,500&display=fallback);.header{display:flex;height:80px;background:#009688;background:var(--primary-color);color:#fff;justify-content:center;align-items:center;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.header-title{text-decoration:none;color:rgba(255,255,255,.9);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline4-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:2.125rem;font-size:var(--mdc-typography-headline4-font-size,2.125rem);line-height:2.5rem;line-height:var(--mdc-typography-headline4-line-height,2.5rem);font-weight:400;font-weight:var(--mdc-typography-headline4-font-weight,400);letter-spacing:.0073529412em;letter-spacing:var(--mdc-typography-headline4-letter-spacing,.0073529412em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline4-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline4-text-transform,inherit);font-weight:700}.header-title:hover,.header-title:visited{color:rgba(255,255,255,.9)}.post{background:#fff;background:var(--post-background);padding:3.5rem 4.5rem;margin:0 auto;color:rgba(0,0,0,.87);color:var(--text-color);width:100%;max-width:45rem;box-sizing:border-box}@media screen and (max-width:600px){.post{padding:2rem 1rem}}.post-title{display:block;color:#009688;color:var(--primary-color-text);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline4-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:2.125rem;font-size:var(--mdc-typography-headline4-font-size,2.125rem);line-height:2.5rem;line-height:var(--mdc-typography-headline4-line-height,2.5rem);font-weight:400;font-weight:var(--mdc-typography-headline4-font-weight,400);letter-spacing:.0073529412em;letter-spacing:var(--mdc-typography-headline4-letter-spacing,.0073529412em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline4-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline4-text-transform,inherit);margin-bottom:0;margin-top:0}.post-meta{display:block;color:#009688;color:var(--primary-color-text);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);margin-top:0}.post-image{max-width:100%;margin:0 auto}.post-image>img{display:block}.post-content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body1-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1rem;font-size:var(--mdc-typography-body1-font-size,1rem);line-height:1.5rem;line-height:var(--mdc-typography-body1-line-height,1.5rem);font-weight:400;font-weight:var(--mdc-typography-body1-font-weight,400);letter-spacing:.03125em;letter-spacing:var(--mdc-typography-body1-letter-spacing,.03125em);text-decoration:inherit;text-decoration:var(--mdc-typography-body1-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body1-text-transform,inherit);font-size:1rem;letter-spacing:normal;box-sizing:border-box;margin:0}.post-content h1{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline5-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.5rem;font-size:var(--mdc-typography-headline5-font-size,1.5rem);line-height:2rem;line-height:var(--mdc-typography-headline5-line-height,2rem);font-weight:400;font-weight:var(--mdc-typography-headline5-font-weight,400);letter-spacing:normal;letter-spacing:var(--mdc-typography-headline5-letter-spacing,normal);text-decoration:inherit;text-decoration:var(--mdc-typography-headline5-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline5-text-transform,inherit)}.post-content h2{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);margin:0;margin-top:2rem}.post-content h2+h3{margin-top:1em}.post-content h3{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);font-size:1.1rem;line-height:1.5rem;margin:2em 0 0}.post-content h4{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);font-size:1rem;letter-spacing:normal;margin:2em 0 0;color:rgba(0,0,0,.6);color:var(--faded-color)}.post-content a{color:#009688;color:var(--primary-color-text);text-decoration-skip-ink:auto}.post-content a:hover,.post-content a:visited{color:#009688;color:var(--primary-color-text)}.post-content pre{border-radius:2px;margin:0;padding:16px;font-size:.9375em;font-style:normal;font-weight:400;letter-spacing:normal;line-height:normal;font-family:"Roboto Mono",monospace;overflow-x:auto}.post-content pre+pre{margin-top:16px}.post-content code{font-size:.9375em;color:#0d47a1;color:var(--code-color);font-family:"Roboto Mono",monospace}.post-content strong{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);font-size:1rem;letter-spacing:normal}.post-content figure{max-width:100%;box-sizing:border-box;margin:0}.post-content figcaption{text-align:center;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-caption-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.75rem;font-size:var(--mdc-typography-caption-font-size,.75rem);line-height:1.25rem;line-height:var(--mdc-typography-caption-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-caption-font-weight,400);letter-spacing:.0333333333em;letter-spacing:var(--mdc-typography-caption-letter-spacing,.0333333333em);text-decoration:inherit;text-decoration:var(--mdc-typography-caption-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-caption-text-transform,inherit);margin:0}.post-content blockquote{margin:1.5em 0 2em 2.5em;border-left:1px solid #00bfa5;padding-left:1rem}.post-content table{display:block;margin:0 0 2rem;border-collapse:collapse;text-align:center;overflow-x:auto}.post-content table th{font-weight:500}.post-content table td,.post-content table th{padding:8px;border:1px solid #ddd}.post-content li+li{margin-top:.5rem}.post-content .overflow-x{overflow-x:auto}.post-tags{display:flex;align-items:baseline;flex-grow:1;line-height:normal;color:rgba(0,0,0,.6);color:var(--faded-color)}.post-tags-list{display:inline-block;flex-grow:1;margin-left:.2rem;font-family:"Roboto Mono",monospace;letter-spacing:normal}.footer{display:flex;flex-flow:column nowrap;width:100%;background:#009688;background:var(--primary-color);color:#fff;padding:16px;box-sizing:border-box;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-contents{display:flex;position:relative;flex-flow:row nowrap;justify-content:center;align-items:center;margin:0 auto 0 auto;flex-shrink:0;box-sizing:border-box;padding:0 24px;width:100%;max-width:45rem}@media (max-width:600px){.footer-contents{flex-wrap:wrap;padding:0}}.footer-avatar{border-radius:10%;width:100px;height:100px;background:#000;flex-grow:0;flex-shrink:0;margin-right:16px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-text{flex-grow:1;flex-shrink:1;padding:16px;width:50%}.footer-heading{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);margin-bottom:8px}.footer-description{margin:0}.footer-icons{display:block;flex-shrink:0;margin:.5rem 0}.footer-icons-row{display:block;flex-shrink:0}@media (max-width:600px){.footer-icons-row{display:inline-block}}.footer-bubble{display:inline-block;border-radius:50%;height:40px;width:40px;flex-shrink:0;margin:2px;background-repeat:no-repeat;background-size:contain;background-position:center}.footer-twitter{background-image:url(/assets/images/twitter.svg)}.footer-github{border-radius:0;background-image:url(/assets/images/github.svg)}.footer-email{background-image:url(/assets/images/email.svg)}.footer-feed{background-image:url(/assets/images/feed.svg)}.footer-bottom{display:flex;position:relative;justify-content:center;margin:8px auto 0 auto;flex-shrink:0;width:100%;max-width:45rem}.footer-bottom::before{display:block;position:absolute;top:50%;width:100%;height:1px;background:rgba(255,255,255,.17);content:""}.footer-copyright{display:inline-block;text-align:center;background:#009688;background:var(--primary-color);z-index:2;padding:0 8px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-caption-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.75rem;font-size:var(--mdc-typography-caption-font-size,.75rem);line-height:1.25rem;line-height:var(--mdc-typography-caption-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-caption-font-weight,400);letter-spacing:.0333333333em;letter-spacing:var(--mdc-typography-caption-letter-spacing,.0333333333em);text-decoration:inherit;text-decoration:var(--mdc-typography-caption-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-caption-text-transform,inherit);margin:0}.footer-copyright a{color:rgba(255,255,255,.9);text-decoration:none;font-weight:700}.footer-copyright a:hover,.footer-copyright a:visited{color:rgba(255,255,255,.9)}.light-mode.light-mode,:root{--syntax-red:#B71C1C;--syntax-orange:#E65100;--syntax-green:#1B5E20;--syntax-cyan:#006064;--syntax-blue:#0D47A1;--syntax-purple:#4A148C;--syntax-brown:#3E2723;--syntax-yellow:#3E2723;--syntax-gray:#616161;--syntax-text:rgba(0, 0, 0, 0.87);--syntax-separator:#373B41;--syntax-background:#F5F5F5}@media (prefers-color-scheme:dark){:root{--syntax-red:#EF9A9A;--syntax-orange:#FFCC80;--syntax-green:#A5D6A7;--syntax-cyan:#80DEEA;--syntax-blue:#90CAF9;--syntax-purple:#CE93D8;--syntax-brown:#BCAAA4;--syntax-yellow:#FFF59D;--syntax-gray:#BDBDBD;--syntax-text:#F5F5F5;--syntax-separator:#BFCDE3;--syntax-background:#212121}}.dark-mode.dark-mode{--syntax-red:#EF9A9A;--syntax-orange:#FFCC80;--syntax-green:#A5D6A7;--syntax-cyan:#80DEEA;--syntax-blue:#90CAF9;--syntax-purple:#CE93D8;--syntax-brown:#BCAAA4;--syntax-yellow:#FFF59D;--syntax-gray:#BDBDBD;--syntax-text:#F5F5F5;--syntax-separator:#BFCDE3;--syntax-background:#212121}.post-content pre{background:#f5f5f5;background:var(--syntax-background)}.post-content pre code{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .comment{color:#616161;color:var(--syntax-gray)}.post-content pre code .comment .markup.link{color:#616161;color:var(--syntax-gray)}.post-content pre code .entity.name.type{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .entity.other.inherited-class{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .keyword{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .keyword.control{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .keyword.operator{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .keyword.other.special-method{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .keyword.other.unit{color:#e65100;color:var(--syntax-orange)}.post-content pre code .storage{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .constant{color:#e65100;color:var(--syntax-orange)}.post-content pre code .constant.character.escape{color:#006064;color:var(--syntax-cyan)}.post-content pre code .constant.numeric{color:#e65100;color:var(--syntax-orange)}.post-content pre code .constant.other.color{color:#006064;color:var(--syntax-cyan)}.post-content pre code .constant.other.symbol{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .variable{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .variable.interpolation{color:#3e2723;color:var(--syntax-brown)}.post-content pre code .variable.parameter.function{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .invalid.illegal{background:#b71c1c;background:var(--syntax-red);color:#f5f5f5;color:var(--syntax-background)}.post-content pre code .string{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .string.regexp{color:#006064;color:var(--syntax-cyan)}.post-content pre code .string.regexp .source.ruby.embedded{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .string.other.link{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .punctuation.definition.array,.post-content pre code .punctuation.definition.parameters{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .punctuation.definition.heading,.post-content pre code .punctuation.definition.identity{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .punctuation.definition.bold{color:#3e2723;color:var(--syntax-yellow);font-weight:700}.post-content pre code .punctuation.definition.italic{color:#4a148c;color:var(--syntax-purple);font-style:italic}.post-content pre code .punctuation.section.embedded{color:#3e2723;color:var(--syntax-brown)}.post-content pre code .punctuation.section.class,.post-content pre code .punctuation.section.inner-class,.post-content pre code .punctuation.section.method{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .support.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .support.function{color:#006064;color:var(--syntax-cyan)}.post-content pre code .support.function.any-method{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.function{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.class,.post-content pre code .entity.name.type.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .entity.name.section{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.tag{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .entity.other.attribute-name{color:#e65100;color:var(--syntax-orange)}.post-content pre code .entity.other.attribute-name.id{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .meta.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .meta.class.body{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.link{color:#e65100;color:var(--syntax-orange)}.post-content pre code .meta.method,.post-content pre code .meta.method-call{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.require{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .meta.selector{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .meta.separator{background:#373b41;background:var(--syntax-separator);color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.tag{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .none{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .markup.bold{color:#e65100;color:var(--syntax-orange);font-weight:700}.post-content pre code .markup.changed{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .markup.deleted{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .markup.italic{color:#4a148c;color:var(--syntax-purple);font-style:italic}.post-content pre code .markup.heading{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .markup.heading .punctuation.definition.heading{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .markup.link{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .markup.inserted{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .markup.quote{color:#e65100;color:var(--syntax-orange)}.post-content pre code .markup.raw{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .source.gfm .markup{-webkit-font-smoothing:auto}.post-content pre code .source.gfm .link .entity{color:#006064;color:var(--syntax-cyan)}.aspect-ratio{--aspect-ratio-w:1;--aspect-ratio-h:1;position:relative}.aspect-ratio>:first-child{width:100%}@supports (--custom-props:true){.aspect-ratio::before{display:block;padding-top:calc(var(--aspect-ratio-h,1)/ var(--aspect-ratio-w,1) * 100%);content:""}.aspect-ratio>:first-child{position:absolute;top:0;right:0;bottom:0;left:0;height:100%;width:100%}}.light-mode.light-mode,:root{--mdc-theme-primary:#009688;--primary-color:#009688;--primary-color-text:#009688;--page-background:#eceff1;--post-background:white;--text-color:rgba(0, 0, 0, 0.87);--code-color:#0D47A1;--faded-color:rgba(0, 0, 0, 0.6)}.dark-mode.dark-mode{--mdc-theme-primary:#00695C;--primary-color:#00695C;--primary-color-text:#80CBC4;--page-background:#212121;--post-background:#424242;--text-color:rgba(255, 255, 255, 0.9);--code-color:#BBDEFB;--faded-color:rgba(255, 255, 255, 0.6)}@media (prefers-color-scheme:dark){:root{--mdc-theme-primary:#00695C;--primary-color:#00695C;--primary-color-text:#80CBC4;--page-background:#212121;--post-background:#424242;--text-color:rgba(255, 255, 255, 0.9);--code-color:#BBDEFB;--faded-color:rgba(255, 255, 255, 0.6)}}body,html{display:flex;flex-direction:column;margin:0;padding:0;box-sizing:border-box;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-font-family,Rubik,sans-serif);height:100%;color:rgba(0,0,0,.87);color:var(--text-color);background:#eceff1;background:var(--page-background)}.site-content{flex-grow:1;background:#eceff1;background:var(--page-background);box-sizing:border-box}.mdc-button{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}
  
  </style>

  
</head>


  <body>

    <header class="header" role="banner">
<div>
  <a class="header-title" href="/">sgom.es</a>
</div>
</header>


    <main class="site-content" aria-label="Content">
        
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">So you want to use Redux (pt 2) — reducers and scale</h1>
    <time class="post-meta" datetime="2019-01-15T11:45:00+00:00" itemprop="datePublished">(2019-01-15)</time>
  </header>

  <div class="post-content" itemprop="articleBody">
    
<p><a href="https://sgom.es/posts/2018-12-06-so-you-want-to-use-redux-part-1/">Last time</a> we looked at an overview of how Redux and its interface with React work, and we explored various performance issues that you can encounter when writing Redux selectors.</p>
<p>Today, we’ll be looking at reducers, as well as the problems you can run into as you hit a certain scale in terms of the number of components connected to Redux and their usage of it.</p>
<h2 id="reducers">Reducers</h2>
<p>Whereas selectors retrieve a part of the state tree to be used somewhere, reducers modify a part of the state tree in response to an action.</p>
<p>Writing reducers typically involves fewer performance concerns than selectors, since they tend to do actual work less often. A reducer usually looks for just a few actions to act upon, and will just return the previous state otherwise:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>settings</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>state</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="punctuation section scope begin js"><span>{</span></span><span class="punctuation section scope end js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span>&nbsp;</span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>type</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="constant other js"><span>UPDATE_SETTINGS</span></span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something.</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;...</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;newState</span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;</span><span class="punctuation definition section switch-block end bracket curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Some&nbsp;other&nbsp;action</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;state</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>This means that only a handful of reducers will do meaningful work on any given action, which usually causes no performance issues. In some cases, you&#39;ll still run into them, however.</p>
<h3 id="problem-1-slow-reducers">Problem #1: slow reducers</h3>
<p>This is the obvious one. If you have a slow reducer for an action that happens frequently, you may run into trouble.</p>
<p>It’s hard to offer any kind of useful advice for this scenario, since the solution will be very specific to what you’re trying to do. It will usually involve a combination of making the reducer function faster after some careful profiling, and making it run less frequently.</p>
<p>One good piece of advice (thanks, Jarda Snajdr!) is to make sure that your reducer is as close as it can be to a no-op if it&#39;s not interested in an action; return as early as possible, avoiding any kind of work altogether, even if it&#39;s just allocating an object or array. The same applies to middleware functions.</p>
<p>Also make sure that your reducer isn’t doing anything unexpected, such as dispatching extra actions. Reducers should be pure functions, without any side-effects.</p>
<h3 id="problem-2-returning-new-references">Problem #2: returning new references</h3>
<p>Oh yes, you can run into this problem in reducers too.</p>
<p>Going back a bit, the purpose of a reducer is to perform a change in the state tree when needed. Selectors then access the state tree and retrieve the updated state.</p>
<p><a href="https://sgom.es/posts/2018-12-06-so-you-want-to-use-redux-part-1/#problem-2-returning-new-references">As we saw last time</a>, if these selectors return a different reference every time, they’ll likely cause unnecessary work by making the connected components update when they’re really just getting the same values. So we use memoization in selectors to prevent that from happening: the same inputs will generate the same output.</p>
<p>But what if the reference changes in the state tree itself? Then the input is no longer the same, and the memoization in the selector won’t help.</p>
<p>Let’s look at an example. Say you have an action that gets called when you retrieve data from an API. This call gets made periodically and is used to update some sort of running display. Here’s a naive reducer:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>stats</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>state</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="punctuation section scope begin js"><span>{</span></span><span class="punctuation section scope end js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span>&nbsp;</span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>type</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="constant other js"><span>STATS_API_RECEIVE</span></span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>data</span></span><span class="punctuation terminator statement js"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;An&nbsp;array&nbsp;of&nbsp;data&nbsp;points.</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;</span><span class="punctuation definition section switch-block end bracket curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;state</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>This may look fine at first glance, since it’s easy to miss that every API response will be a new reference, even if the data being returned is the same. This is not what we want, though; the state will always change whenever the action is received, even if the data is the same, and so the selectors will return a new reference too, even if they’re using memoization.</p>
<p>In this case, if we want to make sure that the state only changes when the data does, we’ll need to perform a deep comparison:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Deep&nbsp;comparison&nbsp;helper.</span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>isEqual</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>lodash</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>stats</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>state</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="punctuation section scope begin js"><span>{</span></span><span class="punctuation section scope end js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span>&nbsp;</span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta switch-statement js"><span class="keyword control switch js"><span>switch</span></span><span class="punctuation definition switch-expression begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>type</span></span><span>&nbsp;</span><span class="punctuation definition switch-expression end bracket round js"><span>)</span></span><span>&nbsp;</span><span class="punctuation definition section switch-block begin bracket curly js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control case js"><span>case</span></span><span>&nbsp;</span><span class="constant other js"><span>STATS_API_RECEIVE</span></span><span class="punctuation definition section case-statement js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>isEqual</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;state</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>data</span></span><span>&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="keyword operator ternary js"><span>?</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>state</span><span>&nbsp;</span><span class="keyword operator ternary js"><span>:</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>action</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>data</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta switch-statement js"><span>&nbsp;&nbsp;</span><span class="punctuation definition section switch-block end bracket curly js"><span>}</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;state</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>The tradeoff there becomes reducer speed versus rendering speed; since we’re now doing a deep comparison in the reducer, it’ll be slower, but it’ll save time in unnecessary re-rendering of the same data.</p>
<p>This is usually a win, but the only way to be sure, as with anything to do with performance, is to measure!</p>
<h2 id="problems-with-scale">Problems with scale</h2>
<p>Beyond the more specific performance problems with selectors and reducers that we’ve discussed, your Redux application can run into other categories of performance issues as it hits a certain size.</p>
<p>Scaling is an interesting topic in React + Redux apps. The combination works best at some scale, when you have many individual components connected to the store, when you’ve taken care to memoize selectors where needed, and when you’ve ensured your reducers are fast. But if your application grows beyond a certain state tree size and usage, you may still run into issues due to the sheer amount of work that can go on inside of this architecture.</p>
<p>Imagine you’re developing a large interactive application with hundreds or thousands of component instances connected to the Redux store. This application receives keyboard input and creates an action for every keystroke. You notice that text input gets really sluggish and that there’s a ton of Redux work going on whenever you type. What can you do to fix things?</p>
<h3 id="solution-1-make-changes-less-often">Solution #1: make changes less often</h3>
<p>Part of the problem is that you’re updating the state tree on every keystroke. Is that really necessary? Typically only the element you’re typing into needs to know about changes immediately (so it can display them), with the rest of the application being happy waiting a while before being notified.</p>
<p>This is a good use-case for some debouncing. Debouncing is a technique where you don’t run a function immediately, but rather you wait for a given period of time to see if another invocation comes along. If it does, you reset the counter and wait again; if it doesn’t, then at the end of the wait you actually call the function with the last values received.</p>
<p>In our earlier scenario, we can make sure that the component that receives the input updates its visual state immediately, but uses some debouncing before dispatching a change action.</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Debouncing&nbsp;helper.</span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>debounce</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>lodash</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>WAIT_TIME</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant numeric decimal js"><span>1000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>TextField</span></span><span>&nbsp;</span><span class="storage modifier js"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class js"><span>Component</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;debouncedStoreUpdate&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>debounce</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>value</span></span><span>&nbsp;</span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>props</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>dispatchTextFieldUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;value&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other js"><span>WAIT_TIME</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function method definition js"><span class="entity name function js"><span>handleChange</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="support variable dom js"><span>event</span></span><span>&nbsp;</span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>newValue</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="support variable dom js"><span>event</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>target</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>value</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Render&nbsp;component&nbsp;immediately&nbsp;with&nbsp;changes</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable language js"><span>this</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>setState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;value</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;newValue&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;but&nbsp;only&nbsp;update&nbsp;data&nbsp;store&nbsp;after&nbsp;a&nbsp;while.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>debouncedStoreUpdate</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;newValue&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;...</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></code></pre>
<p>This greatly reduces the number of updates to the data store while the user is typing quickly; the application will now effectively wait for a 1 second pause in the user’s typing before it triggers the data store update and all the associated work.</p>
<h3 id="solution-2-multiple-stores">Solution #2: multiple stores</h3>
<p>Sometimes, even if you’ve memoized everything that requires memoization, the sheer number of selectors that need to run is so large that even in their memoized state they collectively take too long. This scenario is easier to hit than it may seem; checking a cache of previous results still takes time, and if you have a few hundred connected components it becomes easy for the whole thing to exceed the 13ms budget you have for rendering a frame during an animation.</p>
<p>The reason why things get slow, in this case, is that each action is causing every selector for every connected component to run. We’ve already made the selectors as fast as possible, and we’ve already reduced the number of times that actions take place (see the previous section), so the next step is to look for ways of minimising the number of running selectors.</p>
<p>Now, Redux is built around the idea of a single store, using reducer composition to keep code modular, and it assumes it’s okay for every selector to always run. And in many cases, this works just fine, but going against the recommendations by having multiple Redux data stores can be useful for certain categories of performance issues.</p>
<p>For example, if you have a frequently-updating part of the state tree that has a relatively small number of components interested in it, with most of the components interested in more seldom-updating parts, multiple stores may be worth a shot. Splitting up the frequently-updating portion into its own store would ensure that only the aforementioned minority of selectors gets called on update, instead of all of them.</p>
<h3 id="solution-3-keeping-things-off-the-data-store">Solution #3: keeping things off the data store</h3>
<p>Yes, this can go against the basic principle of using Redux, but if you’re running into performance issues with a particular frequently-updating bit of state, do consider looking at just how many things depend on it.</p>
<p>If there aren’t that many of them and if they’re all relatively close to each other in the render tree, perhaps consider keeping that state outside of the global state tree and just passing it around via props, as you would if you weren’t using Redux.</p>
<p>You may lose some of the other benefits of Redux, such as easy replayability, but the tradeoff may be worth it in some cases, such as with less important, transient data.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>Redux and React make for an interesting combination with a ton of developer benefits, but this combination can make things harder to debug and fix when you start running into performance issues.</p>
<p>Hopefully, after reading these two articles and being aware of some of the different categories of performance issues you can run into (and some possible fixes), your profiling sessions will be a little bit easier.</p>
<p>I may come back to this topic at some point in the future if I find more interesting problems to discuss, but for now I hope you found this helpful!</p>
<p><strong>Big thanks to Jarda Snajdr for reviewing this article before publishing and offering some great advice!</strong></p>


  </div>

  <div class="post-tags">
      <span class="post-tags-head">Tags:&nbsp;</span>
      <div class="post-tags-list">
        
          redux
        
          react
        
          performance
        
          memoization
        
      </div>
  </div>
</article>

    </main>

    <footer class="footer">
  <div class="footer-contents">
    <img class="footer-avatar" src="/assets/images/avatar.jpg" alt="Author's avatar">

    <div class="footer-text">
      <h2 class="footer-heading">Hey there!</h2>
      <p class="footer-description">I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.</p>
    </div>

    <div class="footer-icons">
      <div class="footer-icons-row">
        <a href="https://twitter.com/sergiomdgomes" class="footer-bubble footer-twitter" aria-label="Author's Twitter page"></a>
        <a href="mailto:mail@sgom.es" class="footer-bubble footer-email" aria-label="Author's email address"></a>
      </div>
      <div class="footer-icons-row">
        <a href="/feed.xml" class="footer-bubble footer-feed" aria-label="Atom feed for this site"></a>
        <a href="https://github.com/sgomes" class="footer-bubble footer-github" aria-label="Author's GitHub profile'"></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">Articles under
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons 4.0 Attribution</a>,
    code under <a rel="license" href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>
    (unless otherwise indicated).</div>
  </div>
</footer>


    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js');
        });
      }
    </script>

  </body>

</html>
