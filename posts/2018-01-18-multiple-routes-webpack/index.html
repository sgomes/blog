<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Multiple routes, bundling and lazy-loading with webpack</title>
  <meta name="description" content="I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.">

    <!--
      Hello, and welcome to the source for my site!
      There's not a lot to see around here, but I hope you get some inspiration/ideas/laughs.

      Here's an ASCII art stick figure saying hi:  o/
                                                  /|
                                                  / \

      Also, no, I'm not Spanish. I just like short domain names.
    -->

  <link rel="canonical" href="https://sgom.es/">
  <link rel="alternate" type="application/rss+xml" title="sgom.es" href="/feed.xml">

  <link rel="manifest" href="/manifest.json">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="sgom.es">
  <link rel="icon" sizes="16x16" href="/assets/images/touch/16x16.png">
  <link rel="icon" sizes="32x32" href="/assets/images/touch/32x32.png">
  <link rel="icon" sizes="192x192" href="/assets/images/touch/192x192.png">
  <link rel="icon" sizes="512x512" href="/assets/images/touch/512x512.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="sgom.es">
  <link rel="apple-touch-icon" href="/assets/images/touch/152x152.png">

  <meta name="msapplication-TileImage" content="/assets/images/touch/144x144.png">
  <meta name="msapplication-TileColor" content="#009688">

  <meta name="theme-color" content="#009688">

  <link rel="preconnect" href="https://fonts.gstatic.com">

  <style>
  
  @import url(https://fonts.googleapis.com/css?family=Roboto+Mono|Rubik:400,500&display=fallback);.header{display:flex;height:80px;background:#009688;color:#fff;justify-content:center;align-items:center;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.header-title{text-decoration:none;color:rgba(255,255,255,.9);font-size:2.125rem;line-height:2.5rem;font-weight:400;letter-spacing:normal;margin:-.5rem 0 4rem -.07em;text-decoration:inherit;text-transform:inherit;font-weight:700}.header-title:hover,.header-title:visited{color:rgba(255,255,255,.9)}@media (prefers-color-scheme:dark){.header{background:#00695c}}.post{background:#fff;padding:3.5rem 4.5rem;margin:0 auto;color:rgba(0,0,0,.87);width:100%;max-width:45rem;box-sizing:border-box}@media screen and (max-width:600px){.post{padding:2rem 1rem}}.post-title{display:block;color:#009688;font-size:1.5rem;line-height:2rem;font-weight:500;letter-spacing:normal;margin:-.5rem 0 1rem -.06em;text-decoration:inherit;text-transform:inherit;margin-bottom:0}.post-meta{display:block;color:#009688;font-size:.875rem;line-height:1.5rem;font-weight:500;letter-spacing:normal;margin:-.25rem 0 .75rem 0;text-decoration:inherit;text-transform:inherit;margin-top:0}@media (prefers-color-scheme:dark){.post-meta{color:#80cbc4}}.post-image{max-width:100%;margin:0 auto}.post-image>img{display:block}.post-content{font-size:.875em;line-height:1.6em;font-weight:400;letter-spacing:normal;margin:-.25em 0 .75em 0;text-decoration:inherit;text-transform:inherit;font-size:1rem;letter-spacing:normal;box-sizing:border-box;margin:0}.post-content h1{font-size:1.5rem;line-height:2rem;font-weight:500;letter-spacing:normal;margin:-.5rem 0 1rem -.06em;text-decoration:inherit;text-transform:inherit}.post-content h2{font-size:1.25rem;line-height:2rem;font-weight:500;letter-spacing:normal;margin:-.5rem 0 1rem -.05em;text-decoration:inherit;text-transform:inherit;margin:0;margin-top:2rem}.post-content h2+h3{margin-top:1em}.post-content h3{font-size:1.25rem;line-height:2rem;font-weight:500;letter-spacing:normal;margin:-.5rem 0 1rem -.05em;text-decoration:inherit;text-transform:inherit;font-size:1.1rem;line-height:1.5rem;margin:2em 0 0}.post-content h4{font-size:.875rem;line-height:1.5rem;font-weight:500;letter-spacing:normal;margin:-.25rem 0 .75rem 0;text-decoration:inherit;text-transform:inherit;font-size:1rem;letter-spacing:normal;margin:2em 0 0;color:rgba(0,0,0,.6)}.post-content a{color:#009688;text-decoration-skip-ink:auto}.post-content a:hover,.post-content a:visited{color:#009688}.post-content pre{border-radius:2px;margin:0;padding:16px;font-size:.9375em;font-style:normal;font-weight:400;letter-spacing:normal;line-height:normal;font-family:'Roboto Mono',monospace;overflow-x:auto}.post-content pre+pre{margin-top:16px}.post-content code{font-size:.9375em;color:#0d47a1;font-family:'Roboto Mono',monospace}.post-content strong{font-size:.875rem;line-height:1.5rem;font-weight:500;letter-spacing:normal;margin:-.25rem 0 .75rem 0;text-decoration:inherit;text-transform:inherit;font-size:1rem;letter-spacing:normal}.post-content figure{max-width:100%;box-sizing:border-box;margin:0}.post-content figcaption{text-align:center;font-size:.75rem;line-height:1.25rem;font-weight:400;letter-spacing:normal;margin:-.5rem 0 1rem -.04em;text-decoration:inherit;text-transform:inherit;margin:0}.post-content blockquote{margin:1.5em 0 2em 2.5em;border-left:1px solid #00bfa5;padding-left:1rem}.post-content table{display:block;margin:0 0 2rem;border-collapse:collapse;text-align:center;overflow-x:auto}.post-content table th{font-weight:500}.post-content table td,.post-content table th{padding:8px;border:1px solid #ddd}.post-content li+li{margin-top:.5rem}.post-content .overflow-x{overflow-x:auto}@media (prefers-color-scheme:dark){.post{color:rgba(255,255,255,.9);background:#424242}.post-title{color:#80cbc4}.post-content a{color:#80cbc4}.post-content a:hover,.post-content a:visited{color:#80cbc4}.post-content code{color:#bbdefb}}.post-tags{display:flex;align-items:baseline;flex-grow:1;line-height:normal}.post-tags-list{display:inline-block;flex-grow:1;margin-left:.2rem;font-family:'Roboto Mono',monospace;letter-spacing:normal}.footer{display:flex;flex-flow:column nowrap;width:100%;background:#009688;color:#fff;padding:16px;box-sizing:border-box;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-contents{display:flex;position:relative;flex-flow:row nowrap;justify-content:center;align-items:center;margin:0 auto 0 auto;flex-shrink:0;box-sizing:border-box;padding:0 24px;width:100%;max-width:45rem}@media (max-width:600px){.footer-contents{flex-wrap:wrap;padding:0}}.footer-avatar{border-radius:10%;width:100px;height:100px;background:#000;flex-grow:0;flex-shrink:0;margin-right:16px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-text{flex-grow:1;flex-shrink:1;padding:16px;width:50%}.footer-heading{font-size:1.25rem;line-height:2rem;font-weight:500;letter-spacing:normal;margin:-.5rem 0 1rem -.05em;text-decoration:inherit;text-transform:inherit;margin-bottom:8px}.footer-description{margin:0}.footer-icons{display:block;flex-shrink:0;margin:.5rem 0}.footer-icons-row{display:block;flex-shrink:0}@media (max-width:600px){.footer-icons-row{display:inline-block}}.footer-bubble{display:inline-block;border-radius:50%;height:40px;width:40px;flex-shrink:0;margin:2px;background-repeat:no-repeat;background-size:contain;background-position:center}.footer-twitter{background-image:url(/assets/images/twitter.svg)}.footer-github{border-radius:0;background-image:url(/assets/images/github.svg)}.footer-email{background-image:url(/assets/images/email.svg)}.footer-feed{background-image:url(/assets/images/feed.svg)}.footer-bottom{display:flex;position:relative;justify-content:center;margin:8px auto 0 auto;flex-shrink:0;width:100%;max-width:45rem}.footer-bottom::before{display:block;position:absolute;top:50%;width:100%;height:1px;background:rgba(255,255,255,.17);content:''}.footer-copyright{display:inline-block;text-align:center;background:#009688;z-index:2;padding:0 8px;font-size:.75rem;line-height:1.25rem;font-weight:400;letter-spacing:normal;margin:-.5rem 0 1rem -.04em;text-decoration:inherit;text-transform:inherit;margin:0}.footer-copyright a{color:rgba(255,255,255,.9);text-decoration:none;font-weight:700}.footer-copyright a:hover,.footer-copyright a:visited{color:rgba(255,255,255,.9)}@media (prefers-color-scheme:dark){.footer,.footer-copyright{background:#00695c}}.post-content pre{background:#f5f5f5}.post-content pre code{color:rgba(0,0,0,.87)}.post-content pre code .comment{color:#616161}.post-content pre code .comment .markup.link{color:#616161}.post-content pre code .entity.name.type{color:#3e2723}.post-content pre code .entity.other.inherited-class{color:#1b5e20}.post-content pre code .keyword{color:#4a148c}.post-content pre code .keyword.control{color:#4a148c}.post-content pre code .keyword.operator{color:rgba(0,0,0,.87)}.post-content pre code .keyword.other.special-method{color:#0d47a1}.post-content pre code .keyword.other.unit{color:#e65100}.post-content pre code .storage{color:#4a148c}.post-content pre code .constant{color:#e65100}.post-content pre code .constant.character.escape{color:#006064}.post-content pre code .constant.numeric{color:#e65100}.post-content pre code .constant.other.color{color:#006064}.post-content pre code .constant.other.symbol{color:#1b5e20}.post-content pre code .variable{color:#b71c1c}.post-content pre code .variable.interpolation{color:#3e2723}.post-content pre code .variable.parameter.function{color:rgba(0,0,0,.87)}.post-content pre code .invalid.illegal{background-color:#b71c1c;color:#f5f5f5}.post-content pre code .string{color:#1b5e20}.post-content pre code .string.regexp{color:#006064}.post-content pre code .string.regexp .source.ruby.embedded{color:#3e2723}.post-content pre code .string.other.link{color:#b71c1c}.post-content pre code .punctuation.definition.array,.post-content pre code .punctuation.definition.parameters{color:rgba(0,0,0,.87)}.post-content pre code .punctuation.definition.heading,.post-content pre code .punctuation.definition.identity{color:#0d47a1}.post-content pre code .punctuation.definition.bold{color:#3e2723;font-weight:700}.post-content pre code .punctuation.definition.italic{color:#4a148c;font-style:italic}.post-content pre code .punctuation.section.embedded{color:#3e2723}.post-content pre code .punctuation.section.class,.post-content pre code .punctuation.section.inner-class,.post-content pre code .punctuation.section.method{color:rgba(0,0,0,.87)}.post-content pre code .support.class{color:#3e2723}.post-content pre code .support.function{color:#006064}.post-content pre code .support.function.any-method{color:#0d47a1}.post-content pre code .entity.name.function{color:#0d47a1}.post-content pre code .entity.name.class,.post-content pre code .entity.name.type.class{color:#3e2723}.post-content pre code .entity.name.section{color:#0d47a1}.post-content pre code .entity.name.tag{color:#b71c1c}.post-content pre code .entity.other.attribute-name{color:#e65100}.post-content pre code .entity.other.attribute-name.id{color:#0d47a1}.post-content pre code .meta.class{color:#3e2723}.post-content pre code .meta.class.body{color:rgba(0,0,0,.87)}.post-content pre code .meta.link{color:#e65100}.post-content pre code .meta.method,.post-content pre code .meta.method-call{color:rgba(0,0,0,.87)}.post-content pre code .meta.require{color:#0d47a1}.post-content pre code .meta.selector{color:#4a148c}.post-content pre code .meta.separator{background-color:#373b41;color:rgba(0,0,0,.87)}.post-content pre code .meta.tag{color:rgba(0,0,0,.87)}.post-content pre code .none{color:rgba(0,0,0,.87)}.post-content pre code .markup.bold{color:#e65100;font-weight:700}.post-content pre code .markup.changed{color:#4a148c}.post-content pre code .markup.deleted{color:#b71c1c}.post-content pre code .markup.italic{color:#4a148c;font-style:italic}.post-content pre code .markup.heading{color:#b71c1c}.post-content pre code .markup.heading .punctuation.definition.heading{color:#0d47a1}.post-content pre code .markup.link{color:#0d47a1}.post-content pre code .markup.inserted{color:#1b5e20}.post-content pre code .markup.quote{color:#e65100}.post-content pre code .markup.raw{color:#1b5e20}.post-content pre code .source.gfm .markup{-webkit-font-smoothing:auto}.post-content pre code .source.gfm .link .entity{color:#006064}@media (prefers-color-scheme:dark){.post-content pre{background:#212121}.post-content pre code{color:#f5f5f5}.post-content pre code .comment{color:#bdbdbd}.post-content pre code .comment .markup.link{color:#bdbdbd}.post-content pre code .entity.name.type{color:#fff59d}.post-content pre code .entity.other.inherited-class{color:#a5d6a7}.post-content pre code .keyword{color:#ce93d8}.post-content pre code .keyword.control{color:#ce93d8}.post-content pre code .keyword.operator{color:#f5f5f5}.post-content pre code .keyword.other.special-method{color:#90caf9}.post-content pre code .keyword.other.unit{color:#ffcc80}.post-content pre code .storage{color:#ce93d8}.post-content pre code .constant{color:#ffcc80}.post-content pre code .constant.character.escape{color:#80deea}.post-content pre code .constant.numeric{color:#ffcc80}.post-content pre code .constant.other.color{color:#80deea}.post-content pre code .constant.other.symbol{color:#a5d6a7}.post-content pre code .variable{color:#ef9a9a}.post-content pre code .variable.interpolation{color:#bcaaa4}.post-content pre code .variable.parameter.function{color:#f5f5f5}.post-content pre code .invalid.illegal{background-color:#ef9a9a;color:#f5f5f5}.post-content pre code .string{color:#a5d6a7}.post-content pre code .string.regexp{color:#80deea}.post-content pre code .string.regexp .source.ruby.embedded{color:#fff59d}.post-content pre code .string.other.link{color:#ef9a9a}.post-content pre code .punctuation.definition.array,.post-content pre code .punctuation.definition.parameters{color:#f5f5f5}.post-content pre code .punctuation.definition.heading,.post-content pre code .punctuation.definition.identity{color:#90caf9}.post-content pre code .punctuation.definition.bold{color:#fff59d}.post-content pre code .punctuation.definition.italic{color:#ce93d8}.post-content pre code .punctuation.section.embedded{color:#bcaaa4}.post-content pre code .punctuation.section.class,.post-content pre code .punctuation.section.inner-class,.post-content pre code .punctuation.section.method{color:#f5f5f5}.post-content pre code .support.class{color:#fff59d}.post-content pre code .support.function{color:#80deea}.post-content pre code .support.function.any-method{color:#90caf9}.post-content pre code .entity.name.function{color:#90caf9}.post-content pre code .entity.name.class,.post-content pre code .entity.name.type.class{color:#fff59d}.post-content pre code .entity.name.section{color:#90caf9}.post-content pre code .entity.name.tag{color:#ef9a9a}.post-content pre code .entity.other.attribute-name{color:#ffcc80}.post-content pre code .entity.other.attribute-name.id{color:#90caf9}.post-content pre code .meta.class{color:#fff59d}.post-content pre code .meta.class.body{color:#f5f5f5}.post-content pre code .meta.link{color:#ffcc80}.post-content pre code .meta.method,.post-content pre code .meta.method-call{color:#f5f5f5}.post-content pre code .meta.require{color:#90caf9}.post-content pre code .meta.selector{color:#ce93d8}.post-content pre code .meta.separator{background-color:#bfcde3;color:#f5f5f5}.post-content pre code .meta.tag{color:#f5f5f5}.post-content pre code .none{color:#f5f5f5}.post-content pre code .markup.bold{color:#ffcc80}.post-content pre code .markup.changed{color:#ce93d8}.post-content pre code .markup.deleted{color:#ef9a9a}.post-content pre code .markup.italic{color:#ce93d8}.post-content pre code .markup.heading{color:#ef9a9a}.post-content pre code .markup.heading .punctuation.definition.heading{color:#90caf9}.post-content pre code .markup.link{color:#90caf9}.post-content pre code .markup.inserted{color:#a5d6a7}.post-content pre code .markup.quote{color:#ffcc80}.post-content pre code .markup.raw{color:#a5d6a7}.post-content pre code .source.gfm .link .entity{color:#80deea}}.aspect-ratio{--aspect-ratio-w:1;--aspect-ratio-h:1;position:relative}.aspect-ratio>:first-child{width:100%}@supports (--custom-props:true){.aspect-ratio::before{display:block;padding-top:calc(var(--aspect-ratio-h,1)/ var(--aspect-ratio-w,1) * 100%);content:""}.aspect-ratio>:first-child{position:absolute;top:0;right:0;bottom:0;left:0;height:100%;width:100%}}body,html{display:flex;flex-direction:column;margin:0;padding:0;box-sizing:border-box;font-family:Rubik,sans-serif;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:100%;color:rgba(0,0,0,.87)}.site-content{flex-grow:1;background:#eceff1;box-sizing:border-box}.mdc-button{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}@media (prefers-color-scheme:dark){body,html{color:rgba(255,255,255,.9);--mdc-theme-primary:#00695C}.site-content{background:#212121}}
  
  </style>

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90468985-1', 'auto');
  ga('send', 'pageview');

</script>

  
</head>


  <body>

    <header class="header" role="banner">
<div>
  <a class="header-title" href="/">sgom.es</a>
</div>
</header>


    <main class="site-content" aria-label="Content">
        
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Multiple routes, bundling and lazy-loading with webpack</h1>
    <time class="post-meta" datetime="2018-01-18T17:30:00+00:00" itemprop="datePublished">(2018-01-18)</time>
  </header>

  <div class="post-content" itemprop="articleBody">
    
<h2 id="looking-at-the-problem">Looking at the problem</h2>
<p>My coworkers and I are writing a client-side vanilla application that is split up into routes. Routes are a way of thinking about and organizing a site’s structure, and they’re usually tied to individual URLs. So in an online shop you might have different routes like home, category listing, product page, and checkout, all of which might have their own JavaScript. For example, a category listing might need code to handle filtering, whereas the checkout route will need code to validate form entries.</p>
<p>We’re not building a fully client-side application, however. A user might get to the site through different pages, such as typing the URL into their address bar and loading the main page, or finding an interesting product in a search engine and clicking through directly to that product’s description page. So each of these routes should have its own URL structure:</p>
<pre><code><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Home:&nbsp;/</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Category&nbsp;listing:&nbsp;/category/42</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Product&nbsp;page:&nbsp;/product/1234</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>Checkout:&nbsp;/checkout</span></span></span></div></code></pre><p>In addition, we don’t really need all the JavaScript for every route when the site is first loaded. Ideally, we just want the JavaScript for the route that was loaded, and the rest can be lazily loaded as the user navigates through the site. But if you do naive bundling, you’re going to get a single massive file that would have to be fully loaded and parsed before anything happened:</p>
<pre><code><div class="line"><span class="text plain"><span class="meta paragraph text"><span>dist/</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>big-bundle.js</span></span></span></div></code></pre><p>This is not ideal as it loads a lot of JavaScript that is not needed. On slow connections, this can mean that the user will have to wait a long time before the page becomes interactive. That is why big upfront bundles are an anti-pattern.</p>
<p>This is where the concept of entry points comes in. Instead of having a single conceptual “main” file that loads everything and boots up the entire application, we chose to have an entry point for each route, with the remaining routes being lazily loaded as needed. So what we’d end up with would be something along the lines of:</p>
<pre><code><div class="line"><span class="text plain"><span class="meta paragraph text"><span>dist/</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>bundle-home.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-category.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-product.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-checkout.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;home.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;category.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;product.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;checkout.js</span></span></span></div></code></pre><p>Only one of the bundle files would be loaded, depending on which route the user takes to get to the site. This file would then lazily load the other modules, as needed, without loading its own. So if the user were to come in through a product, they would load <code>bundle-product.js</code>, which would boot up the page and then would only fetch <code>home.js</code>, <code>category.js</code> and <code>checkout.js</code> if needed.</p>
<p>This solution loads all the necessary code for executing the user’s immediate request while only loading the rest if needed. And while it involves having the same code in multiple files, the user should really only download one version of each module as they navigate through the site.</p>
<h2 id="webpack-and-modules">Webpack and modules</h2>
<p>There’s a myth that webpack is hard to use and takes a ton of configuration to get anywhere. I haven’t been using it for long enough to know if that was ever the case, but it turns out that webpack is actually quite easy to use nowadays! If you’re familiar with ES modules, static imports and dynamic imports, you’re pretty much all set to build some complex apps with good loading practices and without much in the way of configuration.</p>
<p>Webpack understands the standardized syntax for ES modules, as well as static and dynamic module loading. It looks at your code and decides how to split things into bundles depending on what type of importing you’re doing. So, if you load a module statically, it’s going to get bundled in:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="variable other module js"><span>Foo</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./foo.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>Foo</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>doSomething</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p>The above results in a single <code>bundle.js</code> file (or whatever you chose to name it) with all the code.</p>
<p>If instead you load it dynamically, webpack will create a separate bundle and only fetch the extra code on demand:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./foo.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>then</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>module</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="support variable js"><span>module</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>doSomething</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p>The above results in a <code>bundle.js</code> file with some lazy-loading magic, and a <code>0.js</code> file with the code for Foo.</p>
<p><code>0.js</code> is called a “chunk” in webpack terminology, designed to be lazily loaded by other webpack code, and not directly handled by your own code.</p>
<h2 id="multiple-entry-points-and-routing">Multiple entry points and routing</h2>
<p>Alright, so it sounds like you’re all set! You can write standardized module code, which will work both natively in the browser (if your browser already has rolled out support), or through some bundling magic in webpack.</p>
<p>So let’s write some code and see what this actually looks like. I’ll circle back to the original example and use the routes for Home, Category, Product and Checkout, as well as a corresponding entry point for each one.</p>
<p>The modules are pretty simple. You can make them all have a single method with the same name, since the contents don’t really matter for the example:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>printMessage</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="entity name type object console js"><span>console</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function console js"><span>log</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>Hi!&nbsp;This&nbsp;is&nbsp;the&nbsp;Checkout&nbsp;module.</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>Each entry point file would then load its respective module statically, and the others dynamically. In order to avoid tons of code duplication, you’ll need to come up with a simple, consistent interface for exposing everything else. Here’s an example one which I’m calling <code>Router</code>.</p>
<blockquote>
<p><strong>Note:</strong> while it won’t be doing any actual routing, in the traditional sense, this is where the routing code would go if there were any, to be fair! So I still think it’s an OK name :)</p>
</blockquote>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>_modules</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;Home</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./home.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;Category</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./category.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;Product</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./product.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;Checkout</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./checkout.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="variable language default js"><span>default</span></span><span>&nbsp;</span></span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>Router</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage modifier js"><span>static</span></span><span>&nbsp;</span><span class="meta function method definition js"><span class="keyword operator getter js"><span>get</span></span><span>&nbsp;</span><span class="entity name function js"><span>modules</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;_modules</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></code></pre>
<p>Each module is kept as an entry in the _modules object, with the value being the loading promise returned by <code>import()</code>. Note that this will start loading the other routes immediately, which you might not want, but in that case you could always delay the load with an explicit call that would trigger the actual import. For example:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>_modules</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>Home</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./home.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>Category</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./category.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>Product</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./product.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>Checkout</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="keyword control js"><span>import</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./checkout.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta brace round js"><span>)</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="variable language default js"><span>default</span></span><span>&nbsp;</span></span><span class="meta class js"><span class="storage type class js"><span>class</span></span><span>&nbsp;</span><span class="entity name type class js"><span>Router</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage modifier js"><span>static</span></span><span>&nbsp;</span><span class="meta function method definition js"><span class="keyword operator getter js"><span>get</span></span><span>&nbsp;</span><span class="entity name function js"><span>modules</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;_modules</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></code></pre>
<p>But if all four modules are being lazily loaded, how do you avoid duplicating the code in the entry point? Surely one of those needs to be null?</p>
<p>There’s actually no need! Both the browser (with native module support) and webpack do deduplication, where they keep track of which modules have been loaded so that they don’t get loaded twice. So you as a developer don’t need to worry about keeping track of any of it. This makes the entry point really clean and easy to understand:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="variable language import-all js"><span>*</span></span><span>&nbsp;</span><span class="keyword control js"><span>as</span></span><span>&nbsp;</span><span class="variable other module-alias js"><span>Home</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./home.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="variable other module js"><span>Router</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./router.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="entity name type object console js"><span>console</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function console js"><span>log</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>Hello&nbsp;from&nbsp;the&nbsp;Home&nbsp;entry&nbsp;point!</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Here&nbsp;we&nbsp;go&nbsp;through&nbsp;the&nbsp;router&nbsp;to&nbsp;prove&nbsp;a&nbsp;point,</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;but&nbsp;we&nbsp;could&nbsp;of&nbsp;course&nbsp;use&nbsp;Home&nbsp;directly&nbsp;too,</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;e.g.&nbsp;`Home.printMessage()`.</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>Router</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>modules</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>Home</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>then</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>module</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="support variable js"><span>module</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>printMessage</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>Router</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>modules</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>Category</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>then</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>module</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="support variable js"><span>module</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>printMessage</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>Router</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>modules</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>Product</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>then</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>module</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="support variable js"><span>module</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>printMessage</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>Router</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>modules</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>Checkout</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>then</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>module</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="support variable js"><span>module</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>printMessage</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p>Home is loaded statically, so that it’s immediately available and doesn’t require waiting for a lazy load. The router is loaded statically, too. Once you make a request to the router, it checks to see if that module is already loaded, either statically or dynamically at some point. If it has been loaded, the promise resolves immediately. If it hasn’t, it fetches the file, loads the code, and continues the promise chain after that.</p>
<p>This means that all modules can be used the exact same way, whether by the entry module or, if this were a real application with proper URL routing, by the router itself.</p>
<h2 id="so-how-do-i-get-this-to-work-in-webpack">So how do I get this to work in webpack?</h2>
<p>As I mentioned before, all of this should work natively on the browser with no changes, if your browser supports ES modules and ES module loading. You won’t get the performance benefits of bundling without some further work, but the code is still functional.</p>
<p>That said, since most of us are still bundling, we need to find a way to get this to work with webpack. And it turns out it’s very simple! Here’s the <code>webpack.config.js</code> file:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>path</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="support function js"><span>require</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>path</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="support variable js"><span>module</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>exports</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;entry</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bundle-home</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./entry-home.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bundle-category</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./entry-category.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bundle-product</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./entry-product.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bundle-checkout</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./entry-checkout.js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;output</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;path</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable other object js"><span>path</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>resolve</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./dist</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;filename</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>[name].js</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></code></pre>
<p>The key thing here is to make sure that all entry points are part of the same generation, so that you only generate one set of dynamically-loaded chunks. The output filename is based on the key for each entry point, thanks to the use of ‘<code>[name]</code>’, so the output looks like this:</p>
<pre><code><div class="line"><span class="text plain"><span class="meta paragraph text"><span>dist/</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;&nbsp;</span><span class="meta paragraph text"><span>0.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;1.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;2.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;3.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-category.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-checkout.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-home.js</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>&nbsp;&nbsp;bundle-product.js</span></span></span></div></code></pre><p>The numeric files include a module each, wrapped in JSONP. The bundle files each have the code for that entry point, bundled together with the router code and some webpack methods that handle the lazy loading.</p>
<p>If you load <code>bundle-checkout.js</code> in a test page and look at Chrome Developer Tools, you can confirm that only three chunks get loaded, as expected. You can also see that the message from the Checkout module is coming from <code>bundle-checkout.js</code>, meaning that the Checkout module got bundled into that file.</p>
<figure>
  <div class="aspect-ratio post-image"
       style="width: 1330px; --aspect-ratio-w: 1330; --aspect-ratio-h: 676;">
    <img src="devtools.png" alt="DevTools shows correct deduplication">
  </div>
  <figcaption>DevTools shows correct deduplication</figcaption>
</figure>






<h2 id="conclusions-and-caveats">Conclusions and caveats</h2>
<p>Note that this example is pretty simple, and a real-world application would have further requirements and complexities, such as the need to use the <a href="https://webpack.js.org/plugins/commons-chunk-plugin/">CommonsChunkPlugin</a> for more easily splitting out shared bits of code, or perhaps some potential complexities introduced by using NPM modules as dependencies. These would likely require some extra work on your webpack config.</p>
<p>That said, I felt this was an interesting problem and a decent enough solution to share, so I hope you find it useful and it at least serves as a starting point!</p>
<blockquote>
<p>Special thanks to Surma and Sam Dutton for reviewing this article, pointing out some issues, and helping me figure out a cleaner solution!</p>
</blockquote>


  </div>

  <div class="post-tags">
      <span class="post-tags-head">Tags:&nbsp;</span>
      <div class="post-tags-list">
        
          modules
        
          javascript
        
          bundling
        
          webpack
        
      </div>
  </div>
</article>

    </main>

    <footer class="footer">
  <div class="footer-contents">
    <img class="footer-avatar" src="/assets/images/avatar.jpg" alt="Author's avatar">

    <div class="footer-text">
      <h2 class="footer-heading">Hey there!</h2>
      <p class="footer-description">I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.</p>
    </div>

    <div class="footer-icons">
      <div class="footer-icons-row">
        <a href="https://twitter.com/sergiomdgomes" class="footer-bubble footer-twitter" aria-label="Author's Twitter page"></a>
        <a href="mailto:mail@sgom.es" class="footer-bubble footer-email" aria-label="Author's email address"></a>
      </div>
      <div class="footer-icons-row">
        <a href="/feed.xml" class="footer-bubble footer-feed" aria-label="Atom feed for this site"></a>
        <a href="https://github.com/sgomes" class="footer-bubble footer-github" aria-label="Author's GitHub profile'"></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">Articles under
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons 4.0 Attribution</a>,
    code under <a rel="license" href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>
    (unless otherwise indicated).</div>
  </div>
</footer>


    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(function(err) {
          console.log('Service worker registration failed: ', err);
        });
      }
    </script>

  </body>

</html>
