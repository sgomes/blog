<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Everything you never wanted to know about side effects</title>
  <meta name="description" content="I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.">

    <!--
      Hello, and welcome to the source for my site!
      There's not a lot to see around here, but I hope you get some inspiration/ideas/laughs.

      Here's an ASCII art stick figure saying hi:  o/
                                                  /|
                                                  / \

      Also, no, I'm not Spanish. I just like short domain names.
    -->

  <link rel="canonical" href="https://sgom.es/">
  <link rel="alternate" type="application/rss+xml" title="sgom.es" href="/feed.xml">

  <link rel="manifest" href="/manifest.json">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="sgom.es">
  <link rel="icon" sizes="16x16" href="/assets/images/touch/16x16.png">
  <link rel="icon" sizes="32x32" href="/assets/images/touch/32x32.png">
  <link rel="icon" sizes="192x192" href="/assets/images/touch/192x192.png">
  <link rel="icon" sizes="512x512" href="/assets/images/touch/512x512.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="sgom.es">
  <link rel="apple-touch-icon" href="/assets/images/touch/152x152.png">

  <meta name="msapplication-TileImage" content="/assets/images/touch/144x144.png">
  <meta name="msapplication-TileColor" content="#009688">

  <meta name="theme-color" content="#009688">

  <link rel="preconnect" href="https://fonts.gstatic.com">

  <style>
  
  @import url(https://fonts.googleapis.com/css?family=Roboto+Mono|Rubik:400,500&display=fallback);.header{display:flex;height:80px;background:#009688;background:var(--primary-color);color:#fff;justify-content:center;align-items:center;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.header-title{text-decoration:none;color:rgba(255,255,255,.9);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline4-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:2.125rem;font-size:var(--mdc-typography-headline4-font-size,2.125rem);line-height:2.5rem;line-height:var(--mdc-typography-headline4-line-height,2.5rem);font-weight:400;font-weight:var(--mdc-typography-headline4-font-weight,400);letter-spacing:.0073529412em;letter-spacing:var(--mdc-typography-headline4-letter-spacing,.0073529412em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline4-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline4-text-transform,inherit);font-weight:700}.header-title:hover,.header-title:visited{color:rgba(255,255,255,.9)}.post{background:#fff;background:var(--post-background);padding:3.5rem 4.5rem;margin:0 auto;color:rgba(0,0,0,.87);color:var(--text-color);width:100%;max-width:45rem;box-sizing:border-box}@media screen and (max-width:600px){.post{padding:2rem 1rem}}.post-title{display:block;color:#009688;color:var(--primary-color-text);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline4-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:2.125rem;font-size:var(--mdc-typography-headline4-font-size,2.125rem);line-height:2.5rem;line-height:var(--mdc-typography-headline4-line-height,2.5rem);font-weight:400;font-weight:var(--mdc-typography-headline4-font-weight,400);letter-spacing:.0073529412em;letter-spacing:var(--mdc-typography-headline4-letter-spacing,.0073529412em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline4-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline4-text-transform,inherit);margin-bottom:0;margin-top:0}.post-meta{display:block;color:#009688;color:var(--primary-color-text);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);margin-top:0}.post-image{max-width:100%;margin:0 auto}.post-image>img{display:block}.post-content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body1-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1rem;font-size:var(--mdc-typography-body1-font-size,1rem);line-height:1.5rem;line-height:var(--mdc-typography-body1-line-height,1.5rem);font-weight:400;font-weight:var(--mdc-typography-body1-font-weight,400);letter-spacing:.03125em;letter-spacing:var(--mdc-typography-body1-letter-spacing,.03125em);text-decoration:inherit;text-decoration:var(--mdc-typography-body1-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body1-text-transform,inherit);font-size:1rem;letter-spacing:normal;box-sizing:border-box;margin:0}.post-content h1{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline5-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.5rem;font-size:var(--mdc-typography-headline5-font-size,1.5rem);line-height:2rem;line-height:var(--mdc-typography-headline5-line-height,2rem);font-weight:400;font-weight:var(--mdc-typography-headline5-font-weight,400);letter-spacing:normal;letter-spacing:var(--mdc-typography-headline5-letter-spacing,normal);text-decoration:inherit;text-decoration:var(--mdc-typography-headline5-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline5-text-transform,inherit)}.post-content h2{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);margin:0;margin-top:2rem}.post-content h2+h3{margin-top:1em}.post-content h3{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);font-size:1.1rem;line-height:1.5rem;margin:2em 0 0}.post-content h4{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);font-size:1rem;letter-spacing:normal;margin:2em 0 0;color:rgba(0,0,0,.6);color:var(--faded-color)}.post-content a{color:#009688;color:var(--primary-color-text);text-decoration-skip-ink:auto}.post-content a:hover,.post-content a:visited{color:#009688;color:var(--primary-color-text)}.post-content pre{border-radius:2px;margin:0;padding:16px;font-size:.9375em;font-style:normal;font-weight:400;letter-spacing:normal;line-height:normal;font-family:"Roboto Mono",monospace;overflow-x:auto}.post-content pre+pre{margin-top:16px}.post-content code{font-size:.9375em;color:#0d47a1;color:var(--code-color);font-family:"Roboto Mono",monospace}.post-content strong{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-body2-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.875rem;font-size:var(--mdc-typography-body2-font-size,.875rem);line-height:1.25rem;line-height:var(--mdc-typography-body2-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-body2-font-weight,400);letter-spacing:.0178571429em;letter-spacing:var(--mdc-typography-body2-letter-spacing,.0178571429em);text-decoration:inherit;text-decoration:var(--mdc-typography-body2-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-body2-text-transform,inherit);font-size:1rem;letter-spacing:normal}.post-content figure{max-width:100%;box-sizing:border-box;margin:0}.post-content figcaption{text-align:center;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-caption-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.75rem;font-size:var(--mdc-typography-caption-font-size,.75rem);line-height:1.25rem;line-height:var(--mdc-typography-caption-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-caption-font-weight,400);letter-spacing:.0333333333em;letter-spacing:var(--mdc-typography-caption-letter-spacing,.0333333333em);text-decoration:inherit;text-decoration:var(--mdc-typography-caption-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-caption-text-transform,inherit);margin:0}.post-content blockquote{margin:1.5em 0 2em 2.5em;border-left:1px solid #00bfa5;padding-left:1rem}.post-content table{display:block;margin:0 0 2rem;border-collapse:collapse;text-align:center;overflow-x:auto}.post-content table th{font-weight:500}.post-content table td,.post-content table th{padding:8px;border:1px solid #ddd}.post-content li+li{margin-top:.5rem}.post-content .overflow-x{overflow-x:auto}.post-tags{display:flex;align-items:baseline;flex-grow:1;line-height:normal;color:rgba(0,0,0,.6);color:var(--faded-color)}.post-tags-list{display:inline-block;flex-grow:1;margin-left:.2rem;font-family:"Roboto Mono",monospace;letter-spacing:normal}.footer{display:flex;flex-flow:column nowrap;width:100%;background:#009688;background:var(--primary-color);color:#fff;padding:16px;box-sizing:border-box;flex-shrink:0;z-index:2;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-contents{display:flex;position:relative;flex-flow:row nowrap;justify-content:center;align-items:center;margin:0 auto 0 auto;flex-shrink:0;box-sizing:border-box;padding:0 24px;width:100%;max-width:45rem}@media (max-width:600px){.footer-contents{flex-wrap:wrap;padding:0}}.footer-avatar{border-radius:10%;width:100px;height:100px;background:#000;flex-grow:0;flex-shrink:0;margin-right:16px;box-shadow:0 3px 1px -2px rgba(0,0,0,.2),0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12)}.footer-text{flex-grow:1;flex-shrink:1;padding:16px;width:50%}.footer-heading{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-headline6-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:1.25rem;font-size:var(--mdc-typography-headline6-font-size,1.25rem);line-height:2rem;line-height:var(--mdc-typography-headline6-line-height,2rem);font-weight:500;font-weight:var(--mdc-typography-headline6-font-weight,500);letter-spacing:.0125em;letter-spacing:var(--mdc-typography-headline6-letter-spacing,.0125em);text-decoration:inherit;text-decoration:var(--mdc-typography-headline6-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-headline6-text-transform,inherit);margin-bottom:8px}.footer-description{margin:0}.footer-icons{display:block;flex-shrink:0;margin:.5rem 0}.footer-icons-row{display:block;flex-shrink:0}@media (max-width:600px){.footer-icons-row{display:inline-block}}.footer-bubble{display:inline-block;border-radius:50%;height:40px;width:40px;flex-shrink:0;margin:2px;background-repeat:no-repeat;background-size:contain;background-position:center}.footer-twitter{background-image:url(/assets/images/twitter.svg)}.footer-github{border-radius:0;background-image:url(/assets/images/github.svg)}.footer-email{background-image:url(/assets/images/email.svg)}.footer-feed{background-image:url(/assets/images/feed.svg)}.footer-bottom{display:flex;position:relative;justify-content:center;margin:8px auto 0 auto;flex-shrink:0;width:100%;max-width:45rem}.footer-bottom::before{display:block;position:absolute;top:50%;width:100%;height:1px;background:rgba(255,255,255,.17);content:""}.footer-copyright{display:inline-block;text-align:center;background:#009688;background:var(--primary-color);z-index:2;padding:0 8px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-caption-font-family,var(--mdc-typography-font-family,Rubik,sans-serif));font-size:.75rem;font-size:var(--mdc-typography-caption-font-size,.75rem);line-height:1.25rem;line-height:var(--mdc-typography-caption-line-height,1.25rem);font-weight:400;font-weight:var(--mdc-typography-caption-font-weight,400);letter-spacing:.0333333333em;letter-spacing:var(--mdc-typography-caption-letter-spacing,.0333333333em);text-decoration:inherit;text-decoration:var(--mdc-typography-caption-text-decoration,inherit);text-transform:inherit;text-transform:var(--mdc-typography-caption-text-transform,inherit);margin:0}.footer-copyright a{color:rgba(255,255,255,.9);text-decoration:none;font-weight:700}.footer-copyright a:hover,.footer-copyright a:visited{color:rgba(255,255,255,.9)}.light-mode.light-mode,:root{--syntax-red:#B71C1C;--syntax-orange:#E65100;--syntax-green:#1B5E20;--syntax-cyan:#006064;--syntax-blue:#0D47A1;--syntax-purple:#4A148C;--syntax-brown:#3E2723;--syntax-yellow:#3E2723;--syntax-gray:#616161;--syntax-text:rgba(0, 0, 0, 0.87);--syntax-separator:#373B41;--syntax-background:#F5F5F5}@media (prefers-color-scheme:dark){:root{--syntax-red:#EF9A9A;--syntax-orange:#FFCC80;--syntax-green:#A5D6A7;--syntax-cyan:#80DEEA;--syntax-blue:#90CAF9;--syntax-purple:#CE93D8;--syntax-brown:#BCAAA4;--syntax-yellow:#FFF59D;--syntax-gray:#BDBDBD;--syntax-text:#F5F5F5;--syntax-separator:#BFCDE3;--syntax-background:#212121}}.dark-mode.dark-mode{--syntax-red:#EF9A9A;--syntax-orange:#FFCC80;--syntax-green:#A5D6A7;--syntax-cyan:#80DEEA;--syntax-blue:#90CAF9;--syntax-purple:#CE93D8;--syntax-brown:#BCAAA4;--syntax-yellow:#FFF59D;--syntax-gray:#BDBDBD;--syntax-text:#F5F5F5;--syntax-separator:#BFCDE3;--syntax-background:#212121}.post-content pre{background:#f5f5f5;background:var(--syntax-background)}.post-content pre code{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .comment{color:#616161;color:var(--syntax-gray)}.post-content pre code .comment .markup.link{color:#616161;color:var(--syntax-gray)}.post-content pre code .entity.name.type{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .entity.other.inherited-class{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .keyword{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .keyword.control{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .keyword.operator{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .keyword.other.special-method{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .keyword.other.unit{color:#e65100;color:var(--syntax-orange)}.post-content pre code .storage{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .constant{color:#e65100;color:var(--syntax-orange)}.post-content pre code .constant.character.escape{color:#006064;color:var(--syntax-cyan)}.post-content pre code .constant.numeric{color:#e65100;color:var(--syntax-orange)}.post-content pre code .constant.other.color{color:#006064;color:var(--syntax-cyan)}.post-content pre code .constant.other.symbol{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .variable{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .variable.interpolation{color:#3e2723;color:var(--syntax-brown)}.post-content pre code .variable.parameter.function{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .invalid.illegal{background:#b71c1c;background:var(--syntax-red);color:#f5f5f5;color:var(--syntax-background)}.post-content pre code .string{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .string.regexp{color:#006064;color:var(--syntax-cyan)}.post-content pre code .string.regexp .source.ruby.embedded{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .string.other.link{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .punctuation.definition.array,.post-content pre code .punctuation.definition.parameters{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .punctuation.definition.heading,.post-content pre code .punctuation.definition.identity{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .punctuation.definition.bold{color:#3e2723;color:var(--syntax-yellow);font-weight:700}.post-content pre code .punctuation.definition.italic{color:#4a148c;color:var(--syntax-purple);font-style:italic}.post-content pre code .punctuation.section.embedded{color:#3e2723;color:var(--syntax-brown)}.post-content pre code .punctuation.section.class,.post-content pre code .punctuation.section.inner-class,.post-content pre code .punctuation.section.method{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .support.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .support.function{color:#006064;color:var(--syntax-cyan)}.post-content pre code .support.function.any-method{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.function{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.class,.post-content pre code .entity.name.type.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .entity.name.section{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .entity.name.tag{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .entity.other.attribute-name{color:#e65100;color:var(--syntax-orange)}.post-content pre code .entity.other.attribute-name.id{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .meta.class{color:#3e2723;color:var(--syntax-yellow)}.post-content pre code .meta.class.body{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.link{color:#e65100;color:var(--syntax-orange)}.post-content pre code .meta.method,.post-content pre code .meta.method-call{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.require{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .meta.selector{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .meta.separator{background:#373b41;background:var(--syntax-separator);color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .meta.tag{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .none{color:rgba(0,0,0,.87);color:var(--syntax-text)}.post-content pre code .markup.bold{color:#e65100;color:var(--syntax-orange);font-weight:700}.post-content pre code .markup.changed{color:#4a148c;color:var(--syntax-purple)}.post-content pre code .markup.deleted{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .markup.italic{color:#4a148c;color:var(--syntax-purple);font-style:italic}.post-content pre code .markup.heading{color:#b71c1c;color:var(--syntax-red)}.post-content pre code .markup.heading .punctuation.definition.heading{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .markup.link{color:#0d47a1;color:var(--syntax-blue)}.post-content pre code .markup.inserted{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .markup.quote{color:#e65100;color:var(--syntax-orange)}.post-content pre code .markup.raw{color:#1b5e20;color:var(--syntax-green)}.post-content pre code .source.gfm .markup{-webkit-font-smoothing:auto}.post-content pre code .source.gfm .link .entity{color:#006064;color:var(--syntax-cyan)}.aspect-ratio{--aspect-ratio-w:1;--aspect-ratio-h:1;position:relative}.aspect-ratio>:first-child{width:100%}@supports (--custom-props:true){.aspect-ratio::before{display:block;padding-top:calc(var(--aspect-ratio-h,1)/ var(--aspect-ratio-w,1) * 100%);content:""}.aspect-ratio>:first-child{position:absolute;top:0;right:0;bottom:0;left:0;height:100%;width:100%}}.light-mode.light-mode,:root{--mdc-theme-primary:#009688;--primary-color:#009688;--primary-color-text:#009688;--page-background:#eceff1;--post-background:white;--text-color:rgba(0, 0, 0, 0.87);--code-color:#0D47A1;--faded-color:rgba(0, 0, 0, 0.6)}.dark-mode.dark-mode{--mdc-theme-primary:#00695C;--primary-color:#00695C;--primary-color-text:#80CBC4;--page-background:#212121;--post-background:#424242;--text-color:rgba(255, 255, 255, 0.9);--code-color:#BBDEFB;--faded-color:rgba(255, 255, 255, 0.6)}@media (prefers-color-scheme:dark){:root{--mdc-theme-primary:#00695C;--primary-color:#00695C;--primary-color-text:#80CBC4;--page-background:#212121;--post-background:#424242;--text-color:rgba(255, 255, 255, 0.9);--code-color:#BBDEFB;--faded-color:rgba(255, 255, 255, 0.6)}}body,html{display:flex;flex-direction:column;margin:0;padding:0;box-sizing:border-box;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:Rubik,sans-serif;font-family:var(--mdc-typography-font-family,Rubik,sans-serif);height:100%;color:rgba(0,0,0,.87);color:var(--text-color);background:#eceff1;background:var(--page-background)}.site-content{flex-grow:1;background:#eceff1;background:var(--page-background);box-sizing:border-box}.mdc-button{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}
  
  </style>

  
</head>


  <body>

    <header class="header" role="banner">
<div>
  <a class="header-title" href="/">sgom.es</a>
</div>
</header>


    <main class="site-content" aria-label="Content">
        
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Everything you never wanted to know about side effects</h1>
    <time class="post-meta" datetime="2020-06-15T14:30:00+01:00" itemprop="datePublished">(2020-06-15)</time>
  </header>

  <div class="post-content" itemprop="articleBody">
    
<p>A lot of projects use <code>webpack</code> as their bundler, which can reduce the size of its output bundles by using tree-shaking (a type of dead code removal). However, tree-shaking can only work effectively if it knows about side effects in your code and in the packages you make use of. In this blog post I’ll explain what side effects are, why <code>webpack</code> needs to know about them, and what it does with this knowledge.</p>
<h2 id="what-are-side-effects">What are side effects?</h2>
<p>A side effect, in an ECMAScript module context, is code that performs some externally-visible behaviour (that is, behaviour which is visible outside the module) when the module is loaded.</p>
<p>Here is an example:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>registerThing</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>thing-registry</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>store</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>registerThing</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="constant other js"><span>THING_KEY</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;...&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p><code>registerStore</code> is being called at the top level, which means that it will run as soon as the module first gets imported. These changes are visible externally, since things are being modified in an external store that lives in another module (<code>thing-registry</code>). Other examples of side effects include setting globals on <code>window</code>, or adding browser behaviour through polyfills.</p>
<p>However, if this were to happen inside of an <code>init</code> function that doesn’t get called on module load, then that would no longer be a side effect:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>registerThing</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>thing-registry</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>init</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>store</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>registerThing</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="constant other js"><span>THING_KEY</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;...&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;`init`&nbsp;doesn&#39;t&nbsp;get&nbsp;called&nbsp;at&nbsp;the&nbsp;top&nbsp;level&nbsp;of&nbsp;the&nbsp;module,</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;therefore&nbsp;importing&nbsp;the&nbsp;module&nbsp;doesn&#39;t&nbsp;cause&nbsp;side&nbsp;effects.</span></span></span></div></code></pre>
<p>Declaring a variable or performing any modification at the top level that only affects the current module isn’t a side effect either, since it’s contained to the module:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="variable other module js"><span>list</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./list</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Not&nbsp;a&nbsp;side&nbsp;effect.</span></span></span></div><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;localVariable&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span><span>]</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Not&nbsp;a&nbsp;side&nbsp;effect,&nbsp;either.</span></span></span></div><div class="line"><span class="source js"><span class="keyword control js"><span>for</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>entry</span></span><span>&nbsp;</span><span class="keyword operator of js"><span>of</span></span><span>&nbsp;list&nbsp;</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>localVariable</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>push</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>processListEntry</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>&nbsp;entry&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></code></pre>
<h2 id="the-influence-of-side-effects-on-bundling">The influence of side effects on bundling</h2>
<p>Most modern bundlers implement tree-shaking, where unused code is removed from the final bundles, as it’s not necessary. This becomes important in libraries that offer a lot of different functionality, since consumers of that library may only be using a small portion of it and don’t want their bundles to be larger than necessary.</p>
<p>Packages and libraries should thus take steps to ensure they can indeed be correctly tree-shaken, especially when published to the world.</p>
<p>This brings us back to side effects. As we’ve seen, side effects are code that runs simply by virtue of importing a module, and has an external influence of some sort. This means that the code cannot be tree-shaken away; it needs to run, because it changes things outside of the module that may be needed elsewhere.</p>
<p>Unfortunately, side effects are hard to determine automatically, and some bundlers (like <code>webpack</code>) err on the side of caution, assuming that every module potentially has side effects. This becomes a problem for <code>index</code> modules which re-export things from other modules, as that effectively means everything in there must now be bundled together:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;index.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>a</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable other module js"><span>b</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./module1</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>c</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable other module js"><span>d</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable other module js"><span>e</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./module2</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>f</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./module3</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Nothing&nbsp;can&nbsp;be&nbsp;tree-shaken&nbsp;away,&nbsp;because&nbsp;the&nbsp;bundler&nbsp;doesn&#39;t</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;know&nbsp;if&nbsp;this&nbsp;or&nbsp;the&nbsp;re-exported&nbsp;modules&nbsp;have&nbsp;any&nbsp;side&nbsp;effects.</span></span></span></div></code></pre>
<h2 id="telling-bundlers-about-side-effects">Telling bundlers about side effects</h2>
<p>Since bundlers can’t figure out side effects for themselves, we need to explicitly declare them. That’s done in a package’s <code>package.json</code>.</p>
<p>This means that declaring side effects is the responsibility of the package, and for packages that don’t do it, <code>webpack</code> will likely be unable to tree-shake anything away. Users of such a package may then end up pulling all of it into their build, even if they only use a small portion of the package, often with no easy way of getting around it. This is sadly the case for <code>diff</code>, <code>react‑dates</code>, and many other popular packages, at time of writing.</p>
<p>So how <strong>do</strong> you declare side effects? The best way of doing that depends on how much use you make of them and where they are in your code.</p>
<p>Very frequently your package won’t be using any side effects at all. In that situation, you can simply set <code>sideEffects</code> to <code>false</code>:</p>
<pre><code class="language-json"><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary begin json"><span>{</span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>name</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>package</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="punctuation separator dictionary pair json"><span>,</span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>sideEffects</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="constant language json"><span>false</span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary end json"><span>}</span></span></span></span></div></code></pre>
<p>If it has a few files with side effects, you can list them:</p>
<pre><code class="language-json"><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary begin json"><span>{</span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>name</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>package</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="punctuation separator dictionary pair json"><span>,</span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>sideEffects</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="meta structure array json"><span class="punctuation definition array begin json"><span>[</span></span><span>&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>dist/store.js</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="punctuation separator array json"><span>,</span></span><span>&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>dist/polyfill.js</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span>&nbsp;</span><span class="punctuation definition array end json"><span>]</span></span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary end json"><span>}</span></span></span></span></div></code></pre>
<p>This allows the bundler to assume that only the modules that were declared have side effects, and <strong>nothing else does</strong>. Of course, this means that we need to be careful to include everything that <strong>does</strong> have side effects, or problems can arise in applications that make use of the package.</p>
<p><code>webpack</code> supports <a href="https://github.com/micromatch/micromatch#matching-features">a number of complex glob matching features</a>, so another approach you can take is to invert things, and declare which paths are side effect free, leaving <code>webpack</code> to assume that everything else might have side effects:</p>
<pre><code class="language-json"><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary begin json"><span>{</span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>name</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>package</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="punctuation separator dictionary pair json"><span>,</span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span>&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>sideEffects</span><span class="punctuation definition string end json"><span>&quot;</span></span></span><span class="meta structure dictionary value json"><span class="punctuation separator dictionary key-value json"><span>:</span></span><span>&nbsp;</span><span class="meta structure array json"><span class="punctuation definition array begin json"><span>[</span></span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="meta structure dictionary value json"><span class="meta structure array json"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double json"><span class="punctuation definition string begin json"><span>&quot;</span></span><span>!(dist/(components|utils)/**)</span><span class="punctuation definition string end json"><span>&quot;</span></span></span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="meta structure dictionary value json"><span class="meta structure array json"><span>&nbsp;&nbsp;</span><span class="punctuation definition array end json"><span>]</span></span></span></span></span></span></div><div class="line"><span class="source json"><span class="meta structure dictionary json"><span class="punctuation definition dictionary end json"><span>}</span></span></span></span></div></code></pre>
<p>The above example tells the bundler that it should assume that anything outside the <code>components</code> and <code>utils</code> directories contains side effects, and nothing in those directories does. This approach should guarantee that everything in <code>components</code> and <code>utils</code> can be tree-shaken without side effect concerns, and will only potentially cause problems if one of the files in there uses side effects.</p>
<p><em>Edit (2020-06-15)</em>: In some situations, it may be preferable to mark a specific function call as side effect-free, rather than a whole file. Consider the following example:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>noSideEffects</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="entity name function js"><span>noSideEffects</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p>The bundler is unable to tell if the top-level call to <code>noSideEffects</code> contains any side effects. One solution would be to include the module in the <code>package.json</code> <code>sideEffects</code> field, as we&#39;ve seen above. We can also handle it in code with a <code>PURE</code> hint, however:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>noSideEffects</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>#__PURE__</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>noSideEffects</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<p>Big thanks to <a href="https://twitter.com/jaffathecake">Jake Archibald</a> for letting me know about this one! 👍</p>
<h2 id="missing-side-effects-as-a-consumer">Missing side effects as a consumer</h2>
<p>Let’s switch hats for a bit. You’re now the consumer, and you’re importing a package that uses side effects. You want to make use of them; in fact, you’re relying on those side effects to happen, or otherwise your code won’t work correctly.</p>
<p>You may come across some situations where the side effects go unexpectedly missing.</p>
<p>Here is an example:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;index.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>side-effectful-module</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>a</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable other module js"><span>b</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./impl</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></code></pre>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;impl.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>a</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>b</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something&nbsp;that&nbsp;depends&nbsp;on&nbsp;the&nbsp;side&nbsp;effect&nbsp;having&nbsp;run.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>In <code>index.js</code> we see what’s often called a &quot;naked import&quot;; this syntax means we’re not using any of the module’s exports, and we’re effectively only interested in its side effects. Naked imports aren’t side effects themselves, but they’re a very strong signal that side effects are present in whatever it is you’re importing.</p>
<p><code>index.js</code> doesn’t do much beyond importing <code>side-effectful-module</code>, simply re-exporting the functions in <code>impl.js</code>. The key thing here, and what may lead to an issue, is that the functions in <code>impl.js</code> actually depend on the side effect that <code>index.js</code> imported.</p>
<p>If tree-shaking is disabled, such as in development, this will all work correctly. However, if tree-shaking is turned on, the <code>index.js</code> module may be tree-shaken away, leaving just the actual functions from <code>impl.js</code>. If this happens, the side effect will be lost, and <code>b</code> will fail.</p>
<p>The same thing can also happen if the import is done on a child module:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;index.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>unused</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./util</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>b</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something&nbsp;that&nbsp;depends&nbsp;on&nbsp;the&nbsp;side&nbsp;effect&nbsp;having&nbsp;run.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;The&nbsp;module&nbsp;does&nbsp;not&nbsp;use&nbsp;`unused`.</span></span></span></div></code></pre>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;util.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>side-effectful-module</span><span class="punctuation definition string end js"><span>&quot;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>unused</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something&nbsp;that&nbsp;depends&nbsp;on&nbsp;the&nbsp;side&nbsp;effect&nbsp;having&nbsp;run.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></code></pre>
<p>Since <code>unused</code> is not used in <code>index.js</code>, it will be tree-shaken away. This means that nothing from <code>impl.js</code> is needed any more, so none of it will be loaded. Once again we lose the side effect, even though it’s needed.</p>
<h2 id="avoiding-side-effects-being-tree-shaken-away">Avoiding side effects being tree-shaken away</h2>
<p>Since these side effects are essentially automatically-executed unnamed dependencies, we have to treat them as such. If a module has code that depends on a side effect having run, we need to be sure to import it there. The second example can easily be fixed with an extra import in <code>index.js</code>:</p>
<pre><code class="language-js"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;index.js</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>side-effectful-module</span><span class="punctuation definition string end js"><span>&quot;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span><span>&nbsp;</span><span class="variable other module js"><span>unused</span></span><span>&nbsp;</span><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./util</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>b</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Do&nbsp;something&nbsp;that&nbsp;depends&nbsp;on&nbsp;the&nbsp;side&nbsp;effect&nbsp;having&nbsp;run.</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;The&nbsp;module&nbsp;still&nbsp;does&nbsp;not&nbsp;use&nbsp;`unused`.</span></span></span></div></code></pre>
<p>This will guarantee that <code>side-effectful-module</code> will run before any code in <code>index.js</code>, and won’t be tree-shaken away unless <code>index.js</code> also is.</p>
<p>Note that we’re now importing the side effect in both modules, but that’s ok! ES modules only run once, which means that their side effects will only run once as well, no matter how many files they’re imported in.</p>
<h2 id="lets-sum-that-up">Let’s sum that up</h2>
<p>That ended up being a ton of info, so let’s try to summarise the practical advice:</p>
<ul>
<li>If your library doesn’t include side effects, set <code>sideEffects: false</code> in its <code>package.json</code>.</li>
<li>If your library does include side effects, you can still enable as much tree-shaking as possible. List the files with side effects explicitly, or use inverse globs to list the paths that don’t have side effects.</li>
<li>If you’re relying on side effects from an external module, be sure to import that module everywhere you make use of them.</li>
</ul>


  </div>

  <div class="post-tags">
      <span class="post-tags-head">Tags:&nbsp;</span>
      <div class="post-tags-list">
        
          side-effects
        
          bundling
        
          tree-shaking
        
      </div>
  </div>
</article>

    </main>

    <footer class="footer">
  <div class="footer-contents">
    <img class="footer-avatar" src="/assets/images/avatar.jpg" alt="Author's avatar">

    <div class="footer-text">
      <h2 class="footer-heading">Hey there!</h2>
      <p class="footer-description">I’m Sérgio, and I work with Web frontend code. Sometimes I write about it here.</p>
    </div>

    <div class="footer-icons">
      <div class="footer-icons-row">
        <a href="https://twitter.com/sergiomdgomes" class="footer-bubble footer-twitter" aria-label="Author's Twitter page"></a>
        <a href="mailto:mail@sgom.es" class="footer-bubble footer-email" aria-label="Author's email address"></a>
      </div>
      <div class="footer-icons-row">
        <a href="/feed.xml" class="footer-bubble footer-feed" aria-label="Atom feed for this site"></a>
        <a href="https://github.com/sgomes" class="footer-bubble footer-github" aria-label="Author's GitHub profile'"></a>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-copyright">Articles under
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons 4.0 Attribution</a>,
    code under <a rel="license" href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a>
    (unless otherwise indicated).</div>
  </div>
</footer>


    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js');
        });
      }
    </script>

  </body>

</html>
